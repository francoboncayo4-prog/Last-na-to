<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ESP32 Monitoring Dashboard</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    /* ===== GLOBAL ===== */
    * {
      box-sizing: border-box;
      font-family: 'Segoe UI', Arial, sans-serif;
    }

    body {
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: #f1f5f9;
    }

    h1 {
      text-align: center;
      margin-bottom: 10px;
      font-weight: 600;
    }

    /* ===== BUTTONS ===== */
    .buttons {
      text-align: center;
      margin-bottom: 25px;
    }

    .buttons button {
      padding: 10px 20px;
      margin: 5px;
      font-size: 15px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      background: rgba(255, 255, 255, 0.15);
      color: #f8fafc;
      backdrop-filter: blur(8px);
      transition: 0.3s ease;
    }

    .buttons button:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    /* ===== CARDS ===== */
    .cards {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      margin-bottom: 25px;
    }

    .card {
      background: rgba(255, 255, 255, 0.12);
      backdrop-filter: blur(12px);
      padding: 20px;
      border-radius: 16px;
      width: 190px;
      text-align: center;
      font-size: 16px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.3);
    }

    .card span {
      display: block;
      font-size: 1.6rem;
      font-weight: 600;
      margin-top: 6px;
    }

    /* ===== CANVAS ===== */
    canvas {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 15px;
      max-width: 95%;
      margin: 0 auto 30px auto;
      display: block;
    }

    footer {
      text-align: center;
      color: #94a3b8;
      font-size: 0.85rem;
    }
  </style>
</head>

<body>

<h1>ðŸŒŒ ESP32 Environmental Dashboard</h1>

<div class="buttons">
  <button onclick="showSection('live')">Live Data</button>
  <button onclick="showSection('hourly')">Hourly Summary</button>
  <button onclick="showSection('daily')">Daily Summary</button>
</div>

<!-- ===== LIVE ===== -->
<div id="live-section">
  <div class="cards">
    <div class="card">ðŸŒ¡ Temperature<span id="temp">--</span></div>
    <div class="card">ðŸ’§ Humidity<span id="hum">--</span></div>
    <div class="card">ðŸ’¡ Light (Lux)<span id="lux">--</span></div>
    <div class="card">â˜€ UV (V)<span id="uv">--</span></div>
  </div>
  <canvas id="liveChart"></canvas>
</div>

<!-- ===== HOURLY ===== -->
<div id="hourly-section" style="display:none;">
  <canvas id="hourlyChart"></canvas>
</div>

<!-- ===== DAILY ===== -->
<div id="daily-section" style="display:none;">
  <canvas id="dailyChart"></canvas>
</div>

<footer>
  Â© ESP32 Firebase Monitoring System
</footer>

<script>
  /* ===== FIREBASE CONFIG ===== */
  const firebaseConfig = {
    apiKey: "AIzaSyC09rcYujM42cSkheYQSfzw5UCYy2LzeEY",
    databaseURL: "https://virtual-esp32-monitor-default-rtdb.asia-southeast1.firebasedatabase.app"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  /* ===== SECTION SWITCH ===== */
  function showSection(section) {
    document.getElementById('live-section').style.display = 'none';
    document.getElementById('hourly-section').style.display = 'none';
    document.getElementById('daily-section').style.display = 'none';
    document.getElementById(section + '-section').style.display = 'block';
  }

  /* ===== LIVE CHART ===== */
  const liveLabels = [];
  const tempData = [], humData = [], luxData = [], uvData = [];

  const liveChart = new Chart(document.getElementById('liveChart'), {
    type: 'line',
    data: {
      labels: liveLabels,
      datasets: [
        { label: 'Temp (Â°C)', data: tempData, borderColor: '#ff8a65' },
        { label: 'Humidity (%)', data: humData, borderColor: '#64b5f6' },
        { label: 'Light (lux)', data: luxData, borderColor: '#fff176' },
        { label: 'UV (V)', data: uvData, borderColor: '#81c784' }
      ]
    },
    options: {
      responsive: true,
      animation: false,
      scales: {
        x: { ticks: { color: '#e5e7eb' }, grid: { color: 'rgba(255,255,255,0.1)' } },
        y: { ticks: { color: '#e5e7eb' }, grid: { color: 'rgba(255,255,255,0.1)' } }
      },
      plugins: { legend: { labels: { color: '#f1f5f9' } } }
    }
  });

  db.ref("/sensor").on("value", snap => {
    const d = snap.val();
    if (!d) return;

    document.getElementById("temp").innerText = d.temperature.toFixed(1);
    document.getElementById("hum").innerText  = d.humidity.toFixed(1);
    document.getElementById("lux").innerText  = d.light.toFixed(1);
    document.getElementById("uv").innerText   = d.uv.toFixed(2);

    const t = new Date().toLocaleTimeString();
    if (liveLabels.length > 20) {
      liveLabels.shift(); tempData.shift(); humData.shift(); luxData.shift(); uvData.shift();
    }

    liveLabels.push(t);
    tempData.push(d.temperature);
    humData.push(d.humidity);
    luxData.push(d.light);
    uvData.push(d.uv);
    liveChart.update();
  });

  /* ===== HOURLY ===== */
  const hourlyChart = new Chart(document.getElementById('hourlyChart'), {
    type: 'bar',
    data: { labels: [], datasets: [
      { label: 'Temp', data: [], backgroundColor: '#ff8a65' },
      { label: 'Humidity', data: [], backgroundColor: '#64b5f6' },
      { label: 'Light', data: [], backgroundColor: '#fff176' },
      { label: 'UV', data: [], backgroundColor: '#81c784' }
    ]},
    options: { plugins:{ legend:{ labels:{ color:'#f1f5f9' }}}}
  });

  db.ref("/sensor_history").on("value", snap=>{
    const d = snap.val();
    if(!d) return;
    hourlyChart.data.labels = Object.keys(d);
    hourlyChart.data.datasets[0].data = Object.values(d).map(v=>v.avg_temperature);
    hourlyChart.data.datasets[1].data = Object.values(d).map(v=>v.avg_humidity);
    hourlyChart.data.datasets[2].data = Object.values(d).map(v=>v.avg_light);
    hourlyChart.data.datasets[3].data = Object.values(d).map(v=>v.avg_uv);
    hourlyChart.update();
  });

  /* ===== DAILY ===== */
  const dailyChart = new Chart(document.getElementById('dailyChart'), {
    type: 'bar',
    data: { labels: [], datasets: [
      { label: 'Temp', data: [], backgroundColor: '#ff8a65' },
      { label: 'Humidity', data: [], backgroundColor: '#64b5f6' },
      { label: 'Light', data: [], backgroundColor: '#fff176' },
      { label: 'UV', data: [], backgroundColor: '#81c784' }
    ]},
    options: { plugins:{ legend:{ labels:{ color:'#f1f5f9' }}}}
  });

  db.ref("/daily_summary").on("value", snap=>{
    const d = snap.val();
    if(!d) return;
    dailyChart.data.labels = Object.keys(d);
    dailyChart.data.datasets[0].data = Object.values(d).map(v=>v.avg_temperature);
    dailyChart.data.datasets[1].data = Object.values(d).map(v=>v.avg_humidity);
    dailyChart.data.datasets[2].data = Object.values(d).map(v=>v.avg_light);
    dailyChart.data.datasets[3].data = Object.values(d).map(v=>v.avg_uv);
    dailyChart.update();
  });
</script>

</body>
</html>
