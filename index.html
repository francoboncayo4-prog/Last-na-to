<script>
  // ===== FIREBASE CONFIG =====
  const firebaseConfig = {
    apiKey: "AIzaSyC09rcYujM42cSkheYQSfzw5UCYy2LzeEY",
    databaseURL: "https://virtual-esp32-monitor-default-rtdb.asia-southeast1.firebasedatabase.app"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // ===== SECTION SWITCH =====
  function showSection(section) {
    document.getElementById('live-section').style.display = 'none';
    document.getElementById('hourly-section').style.display = 'none';
    document.getElementById('daily-section').style.display = 'none';
    document.getElementById(section + '-section').style.display = 'block';
  }

  // ===== LIVE CHART =====
  const liveLabels = [];
  const tempData = [];
  const humData = [];
  const uvData = [];

  const liveChart = new Chart(document.getElementById('liveChart'), {
    type: 'line',
    data: {
      labels: liveLabels,
      datasets: [
        { label: 'Temp (°C)', data: tempData, borderColor: '#ff5722', tension: 0.3 },
        { label: 'Humidity (%)', data: humData, borderColor: '#2196f3', tension: 0.3 },
        { label: 'UV (V)', data: uvData, borderColor: '#4caf50', tension: 0.3 }
      ]
    },
    options: {
      responsive: true,
      animation: false,
      plugins: { legend: { labels: { color: '#f0f0f0' } } },
      scales: {
        x: { ticks: { color: '#f0f0f0' } },
        y: { ticks: { color: '#f0f0f0' } }
      }
    }
  });

  // ===== LIVE DATA (ALREADY CALIBRATED IN FIREBASE) =====
  db.ref("/sensor").on("value", snapshot => {
    const data = snapshot.val();
    if (!data) return;

    const now = new Date().toLocaleTimeString();

    document.getElementById("temp").innerText = data.temperature.toFixed(1);
    document.getElementById("hum").innerText  = data.humidity.toFixed(1);
    document.getElementById("uv").innerText   = data.uv.toFixed(2);

    if (liveLabels.length > 20) {
      liveLabels.shift();
      tempData.shift();
      humData.shift();
      uvData.shift();
    }

    liveLabels.push(now);
    tempData.push(data.temperature);
    humData.push(data.humidity);
    uvData.push(data.uv);

    liveChart.update();
  });

  // ===== HOURLY SUMMARY =====
  const hourlyChart = new Chart(document.getElementById('hourlyChart'), {
    type: 'bar',
    data: { labels: [], datasets: [
      { label: 'Avg Temp (°C)', data: [], backgroundColor: '#ff5722' },
      { label: 'Avg Humidity (%)', data: [], backgroundColor: '#2196f3' },
      { label: 'Avg UV (V)', data: [], backgroundColor: '#4caf50' }
    ]},
    options: { responsive: true }
  });

  db.ref("/sensor_history").on("value", snapshot => {
    const data = snapshot.val();
    if (!data) return;

    const labels = [], temp = [], hum = [], uv = [];
    Object.keys(data).forEach(key => {
      labels.push(key);
      temp.push(data[key].avg_temperature);
      hum.push(data[key].avg_humidity);
      uv.push(data[key].avg_uv);
    });

    hourlyChart.data.labels = labels;
    hourlyChart.data.datasets[0].data = temp;
    hourlyChart.data.datasets[1].data = hum;
    hourlyChart.data.datasets[2].data = uv;
    hourlyChart.update();
  });

  // ===== DAILY SUMMARY =====
  const dailyChart = new Chart(document.getElementById('dailyChart'), {
    type: 'bar',
    data: { labels: [], datasets: [
      { label: 'Avg Temp (°C)', data: [], backgroundColor: '#ff5722' },
      { label: 'Avg Humidity (%)', data: [], backgroundColor: '#2196f3' },
      { label: 'Avg UV (V)', data: [], backgroundColor: '#4caf50' }
    ]},
    options: { responsive: true }
  });

  db.ref("/daily_summary").on("value", snapshot => {
    const data = snapshot.val();
    if (!data) return;

    const labels = [], temp = [], hum = [], uv = [];
    Object.keys(data).forEach(day => {
      labels.push(day);
      temp.push(data[day].avg_temperature);
      hum.push(data[day].avg_humidity);
      uv.push(data[day].avg_uv);
    });

    dailyChart.data.labels = labels;
    dailyChart.data.datasets[0].data = temp;
    dailyChart.data.datasets[1].data = hum;
    dailyChart.data.datasets[2].data = uv;
    dailyChart.update();
  });
       </script>
