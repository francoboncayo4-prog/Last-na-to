<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Boncayo & AraÃ±o Monitor System</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  margin: 0;
  font-family: 'Segoe UI', Arial, sans-serif;
  background: linear-gradient(180deg, #0f2027, #203a43, #2c5364);
  color: #e0f7fa;
  min-height: 100vh;
  padding: 20px;
}

h1 {
  text-align: center;
  margin-bottom: 10px;
}

.subtitle {
  text-align: center;
  opacity: 0.85;
  margin-bottom: 25px;
}

.buttons {
  text-align: center;
  margin-bottom: 25px;
}

.buttons button {
  background: #00bcd4;
  border: none;
  padding: 10px 18px;
  margin: 5px;
  border-radius: 8px;
  color: #00363a;
  font-size: 16px;
  cursor: pointer;
  transition: 0.2s;
}

.buttons button:hover {
  background: #4dd0e1;
}

.section {
  display: none;
}

.cards {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 15px;
  margin-bottom: 25px;
}

.card {
  background: rgba(255,255,255,0.1);
  padding: 18px;
  border-radius: 12px;
  width: 200px;
  text-align: center;
  backdrop-filter: blur(6px);
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  font-size: 18px;
}

canvas {
  background: rgba(255,255,255,0.1);
  border-radius: 12px;
  padding: 15px;
  max-width: 95%;
  margin: auto;
}

.calibration-box {
  max-width: 400px;
  margin: auto;
  background: rgba(255,255,255,0.1);
  padding: 20px;
  border-radius: 12px;
  backdrop-filter: blur(6px);
}

.calibration-box label {
  display: block;
  margin-top: 15px;
}

.calibration-box input {
  width: 100%;
  padding: 8px;
  border-radius: 6px;
  border: none;
  margin-top: 5px;
}

.calibration-box button {
  width: 100%;
  margin-top: 20px;
  background: #00e5ff;
  border: none;
  padding: 10px;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
}
</style>
</head>

<body>

<h1>Boncayo & AraÃ±o Monitor System</h1>
<div class="subtitle">ESP32 Environmental Monitoring Dashboard</div>

<div class="buttons">
  <button onclick="showSection('live')">Live Data</button>
  <button onclick="showSection('calibration')">Calibration</button>
</div>

<!-- ===== LIVE SECTION ===== -->
<div id="live" class="section">
  <div class="cards">
    <div class="card">ðŸŒ¡ Temperature<br><span id="temp">--</span> Â°C</div>
    <div class="card">ðŸ’§ Humidity<br><span id="hum">--</span> %</div>
    <div class="card">â˜€ UV Voltage<br><span id="uv">--</span> V</div>
  </div>
  <canvas id="liveChart"></canvas>
</div>

<!-- ===== CALIBRATION SECTION ===== -->
<div id="calibration" class="section">
  <div class="calibration-box">
    <h3>Sensor Calibration (Firebase)</h3>

    <label>Temperature Offset (Â°C)</label>
    <input type="number" step="0.1" id="tempOffset">

    <label>Humidity Offset (%)</label>
    <input type="number" step="0.1" id="humOffset">

    <button onclick="saveCalibration()">Save Calibration</button>
  </div>
</div>

<script>
/* ===== FIREBASE CONFIG ===== */
const firebaseConfig = {
  apiKey: "AIzaSyC09rcYujM42cSkheYQSfzw5UCYy2LzeEY",
  databaseURL: "https://virtual-esp32-monitor-default-rtdb.asia-southeast1.firebasedatabase.app"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ===== SECTION CONTROL ===== */
function showSection(id) {
  document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
  document.getElementById(id).style.display = 'block';
}
showSection('live');

/* ===== LIVE CHART ===== */
const labels = [];
const tempData = [];
const humData = [];
const uvData = [];

const chart = new Chart(document.getElementById('liveChart'), {
  type: 'line',
  data: {
    labels,
    datasets: [
      { label: 'Temp (Â°C)', data: tempData, borderColor: '#ff7043' },
      { label: 'Humidity (%)', data: humData, borderColor: '#4fc3f7' },
      { label: 'UV (V)', data: uvData, borderColor: '#aed581' }
    ]
  },
  options: {
    responsive: true,
    animation: false,
    plugins: { legend: { labels: { color: '#e0f7fa' } } },
    scales: {
      x: { ticks: { color: '#e0f7fa' } },
      y: { ticks: { color: '#e0f7fa' } }
    }
  }
});

/* ===== LIVE DATA ===== */
db.ref("/sensor").on("value", snap => {
  const d = snap.val();
  if (!d) return;

  document.getElementById("temp").innerText = d.temperature.toFixed(1);
  document.getElementById("hum").innerText  = d.humidity.toFixed(1);
  document.getElementById("uv").innerText   = d.uv.toFixed(2);

  const time = new Date().toLocaleTimeString();
  if (labels.length > 20) {
    labels.shift(); tempData.shift(); humData.shift(); uvData.shift();
  }

  labels.push(time);
  tempData.push(d.temperature);
  humData.push(d.humidity);
  uvData.push(d.uv);

  chart.update();
});

/* ===== LOAD CALIBRATION ===== */
db.ref("/calibration").on("value", snap => {
  if (!snap.val()) return;
  document.getElementById("tempOffset").value = snap.val().temperature_offset;
  document.getElementById("humOffset").value  = snap.val().humidity_offset;
});

/* ===== SAVE CALIBRATION ===== */
function saveCalibration() {
  db.ref("/calibration").set({
    temperature_offset: parseFloat(tempOffset.value),
    humidity_offset: parseFloat(humOffset.value)
  });
  alert("Calibration saved to Firebase");
}
</script>

</body>
</html>
